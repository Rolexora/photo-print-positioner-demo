<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Photo Print Positioner (PPP)</title>
  <style>
    body { font-family: sans-serif; padding: 1rem; }
    .image-entry { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; }
    label { display: block; margin-top: 5px; }
    canvas { border: 1px solid #000; margin-top: 1rem; }
  </style>
</head>
<body>
  <h1>Photo Print Positioner (PPP)</h1>
  <input type="file" id="fileInput" multiple accept="image/*" />
  <div id="imageList"></div>
  <label>Papírméret:
    <select id="paperSize">
      <option value="9x13">9x13 cm</option>
      <option value="10x15">10x15 cm</option>
      <option value="11x17">11x17 cm</option>
      <option value="13x18">13x18 cm</option>
      <option value="21x29.7">A4 (21x29.7 cm)</option>
      <option value="29.7x42">A3 (29.7x42 cm)</option>
    </select>
  </label>
  <button onclick="generatePDF()">PDF letöltése</button>  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>  <script>
    const { jsPDF } = window.jspdf;
    const imageList = document.getElementById("imageList");
    const fileInput = document.getElementById("fileInput");
    let images = [];

    fileInput.addEventListener("change", (e) => {
      imageList.innerHTML = "";
      images = [];
      [...e.target.files].forEach((file, idx) => {
        const reader = new FileReader();
        reader.onload = (ev) => {
          const img = new Image();
          img.src = ev.target.result;
          img.onload = () => {
            const container = document.createElement("div");
            container.className = "image-entry";
            container.innerHTML = `
              <strong>${file.name}</strong><br>
              <label>Darabszám: <input type="number" value="1" min="1" data-idx="${idx}" class="count-input" /></label>
              <label>Szélesség (cm): <input type="number" step="0.1" value="3" data-idx="${idx}" class="width-input" /></label>
              <label>Magasság (cm): <input type="number" step="0.1" value="4" data-idx="${idx}" class="height-input" /></label>
              <label><input type="checkbox" data-idx="${idx}" class="keep-ratio" checked /> Arány megtartása</label>
            `;
            imageList.appendChild(container);
            images[idx] = { file, src: img.src, width: 3, height: 4, count: 1, keepRatio: true, naturalWidth: img.naturalWidth, naturalHeight: img.naturalHeight };
            container.querySelector(".count-input").addEventListener("input", (e) => images[idx].count = parseInt(e.target.value));
            container.querySelector(".width-input").addEventListener("input", (e) => {
              images[idx].width = parseFloat(e.target.value);
              if (images[idx].keepRatio) {
                const ratio = images[idx].naturalHeight / images[idx].naturalWidth;
                images[idx].height = +(images[idx].width * ratio).toFixed(2);
                container.querySelector(".height-input").value = images[idx].height;
              }
            });
            container.querySelector(".height-input").addEventListener("input", (e) => {
              images[idx].height = parseFloat(e.target.value);
              if (images[idx].keepRatio) {
                const ratio = images[idx].naturalWidth / images[idx].naturalHeight;
                images[idx].width = +(images[idx].height * ratio).toFixed(2);
                container.querySelector(".width-input").value = images[idx].width;
              }
            });
            container.querySelector(".keep-ratio").addEventListener("change", (e) => images[idx].keepRatio = e.target.checked);
          };
        };
        reader.readAsDataURL(file);
      });
    });

    function generatePDF() {
      const paperSelect = document.getElementById("paperSize").value;
      const [paperWcm, paperHcm] = paperSelect.split("x").map(parseFloat);
      const pdf = new jsPDF({ unit: "cm", format: [paperWcm, paperHcm] });

      let x = 0, y = 0, page = 0;
      images.forEach((imgData) => {
        const img = new Image();
        img.src = imgData.src;
        for (let i = 0; i < imgData.count; i++) {
          if (x + imgData.width > paperWcm) {
            x = 0;
            y += imgData.height;
          }
          if (y + imgData.height > paperHcm) {
            pdf.addPage();
            x = 0;
            y = 0;
          }
          pdf.addImage(imgData.src, "JPEG", x, y, imgData.width, imgData.height);
          x += imgData.width;
        }
      });

      pdf.save("photo-print.pdf");
    }
  </script></body>
</html>
